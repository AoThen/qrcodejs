<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>QR Code JS Demo</title>
	<style type="text/css">
	html, body {
		font-family: sans-serif;
	}
	#input {
		width: 90%;
	}
	#output {
		cursor: copy;
	}
	</style>
</head>
<body>
<h1>QR Code JS Demo</h1>

<ul>
  <li>Generate a text-based QR Code for your input.</li>
  <li>Click/tap the code to copy to your clipboard.</li>
  <li>Open source repository: <a href="https://github.com/danielgjackson/qrcodejs">github.com/danielgjackson/qrcodejs</a></li>
</ul>

<div><label>Text: <input type="text" id="text"></label></div>

<pre id="output">
-
</pre>

</body>
<script type="module">
import QrCode from './qrcode.mjs';

function outputMedium(matrix, padding = 4) {
    const lines = [];
    for (let y = -padding; y < matrix.dimension + padding; y += 2) {
        const parts = [];
        for (let x = -padding; x < matrix.dimension + padding; x++) {
            const upper = matrix.getModule(x, y);
            const lower = y + 1 < matrix.dimension ? matrix.getModule(x, y + 1) : 0;
            let c = '?';
            // '▀', '▄', '█' // '\u{0020}' space, '\u{2580}' upper half block, '\u{2584}' lower half block, '\u{2588}' block
            if (upper && lower) c = '█';
            else if (upper && !lower) c = '▀';
            else if (!upper && lower) c = '▄';
            else if (!upper && !lower) c = ' ';
            parts.push(c);
        }
        const line = parts.join('');
        lines.push(line);
    }    
    return lines.join('\r\n');
}

function focus() {
	document.querySelector('#text').select();
}

function change() {
	const text = document.querySelector('#text').value;
	const options = {};
	const matrix = QrCode.generate(text, options);
	const output = outputMedium(matrix);
	document.querySelector('#output').innerText = output;
}

function click() {
	const text = document.querySelector('#output').innerText;
	const temp = document.createElement('textarea');
	temp.value = text;
	document.body.appendChild(temp);
	temp.select();
	document.execCommand('copy');
	document.body.removeChild(temp);
	document.querySelector('#text').focus();
}

function start() {
	document.querySelector('#text').addEventListener('focus', focus);
	document.querySelector('#text').addEventListener('input', change);
	document.querySelector('#output').addEventListener('click', click);
	document.querySelector('#text').focus();
	change();
}

window.addEventListener('DOMContentLoaded', start);

</script>
</html>
